---
title: 'レコード セット: AddNew、Edit、および Delete のしくみ (ODBC) |Microsoft ドキュメント'
ms.custom: ''
ms.date: 11/04/2016
ms.reviewer: ''
ms.suite: ''
ms.technology:
- cpp-windows
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- C++
helpviewer_keywords:
- records [C++], updating
- record editing [C++], in recordsets
- recordsets [C++], adding records
- records [C++], adding
- ODBC recordsets [C++], adding records
- recordsets [C++], editing records
- recordsets [C++], updating
- AddNew method
- ODBC recordsets [C++], deleting records
- records [C++], deleting in recordsets
- data in recordsets [C++]
- recordsets [C++], deleting records
- ODBC recordsets [C++], editing records
- records [C++], editing
ms.assetid: cab43d43-235a-4bed-ac05-67d10e94f34e
caps.latest.revision: 9
author: mikeblome
ms.author: mblome
manager: ghogen
ms.workload:
- cplusplus
- data-storage
ms.openlocfilehash: dbbf224797bd7d2eed2b085a6a7dd8eb1865de1c
ms.sourcegitcommit: 8fa8fdf0fbb4f57950f1e8f4f9b81b4d39ec7d7a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/21/2017
---
# <a name="recordset-how-addnew-edit-and-delete-work-odbc"></a>レコードセット: AddNew、Edit、Delete の動作のしくみ (ODBC)
このトピックの内容は、MFC ODBC クラスに該当します。  
  
 このトピックの内容について説明します、 `AddNew`、**編集**と**削除**クラスのメンバー関数`CRecordset`作業します。 トピックは次のとおりです。  
  
-   [レコードの動作を追加する方法](#_core_adding_a_record)  
  
-   [追加されたレコードの可視性](#_core_visibility_of_added_records)  
  
-   [レコードの編集の動作方法](#_core_editing_an_existing_record)  
  
-   [削除するレコードのしくみ](#_core_deleting_a_record)  
  
> [!NOTE]
>  このトピックの内容は、バルク行フェッチが実装されていない `CRecordset` の派生オブジェクトを対象にしています。 バルク行フェッチを使用している場合は、次を参照してください。[レコード セット: レコードのフェッチ (ODBC)](../../data/odbc/recordset-fetching-records-in-bulk-odbc.md)です。  
  
 を補完することができますを読み取る[レコード フィールド エクス チェンジ: RFX のしくみ](../../data/odbc/record-field-exchange-how-rfx-works.md)、更新操作での RFX の対応するロールをについて説明します。  
  
##  <a name="_core_adding_a_record"></a>レコードを追加します。  

 レコード セットのレコード セットに新しいレコードを追加するのには[AddNew](../../mfc/reference/crecordset-class.md#addnew)メンバー関数の場合、新しいレコードのフィールド データ メンバーの値を設定して、呼び出し、[更新](../../mfc/reference/crecordset-class.md#update)を記述するメンバー関数データ ソースのレコードです。  
  
 呼び出し元の事前条件として`AddNew`、レコード セットする必要がありますが開かれていません読み取り専用です。 `CanUpdate`と`CanAppend`メンバー関数を使用して、これらの条件を確認できます。  
  
 呼び出すと`AddNew`:  
  
-   編集バッファー内のレコードが格納されている操作が取り消された場合、その内容を復元できるようにします。  
  
-   フィールド データ メンバーは、ために後で変更を検出することにフラグが付けられます。 (変更されていない) メンバーもマークされているフィールドのデータをクリーンアップし、Null に設定します。  
  
 呼び出した後`AddNew`エディット バッファーを表す新しいの値を設定する準備完了のレコードを空にします。 これを行うは、それらに割り当てることによって手動で値を設定するだけです。 呼び出すことができます、実際のデータのフィールドの値を指定するには、代わりに`SetFieldNull`を Null 値を指定します。  
  
 変更をコミットするを呼び出す**更新**です。 呼び出すと**更新**新しいレコードの。  
  
-   ODBC ドライバーがサポートされている場合、 **:: SQLSetPos** ODBC API 関数では、MFC では、関数を使用して、データ ソースのレコードを追加します。 **:: SQLSetPos**、MFC レコードを追加できるより効率的に構築し、SQL ステートメントの処理があるないためです。  
  
-   場合**:: SQLSetPos**することはできません、次の処理を MFC を使用します。  
  
    1.  変更が検出されなかった場合**更新**何も行わないし、0 を返します。  
  
    2.  変更がある場合**更新**構築 SQL**挿入**ステートメントです。 すべてのダーティ フィールド データ メンバーによって表される列が一覧表示、**挿入**ステートメントです。 に含まれる列を強制する呼び出し、[き](../../mfc/reference/crecordset-class.md#setfielddirty)メンバー関数。  
  
        ```  
        SetFieldDirty( &m_dataMember, TRUE );  
        ```  
  
    3.  **更新**、新しいレコードをコミット —、**挿入**ステートメントが実行され、トランザクションが進行中の場合を除き、レコードがデータ ソース (および、レコード セットしない場合、スナップショット) のテーブルにコミットします。  
  
    4.  レコードがエディット バッファーに復元されます。 前に、の現在のレコード、`AddNew`呼び出しがかどうかにかかわらずもう一度現在、**挿入**ステートメントが正常に実行されました。  
  
    > [!TIP]
    >  新しいレコードを完全に制御を必要となる場合、次の方法: 値を持つ呼び出すことによって Null が維持されるフィールドを明示的に設定される任意のフィールドの値を設定`SetFieldNull`フィールドであり、パラメーターへのポインターを**は TRUE。** (既定)。 フィールドがデータ ソース、呼び出しに書き込まれないことを確認する場合は、`SetFieldDirty`フィールドであり、パラメーターへのポインターを**FALSE**フィールドの値を変更しないようにします。 フィールドが Null を指定できるかどうかを確認するのには、呼び出す`IsFieldNullable`です。  
  
    > [!TIP]
    >  MFC を使用するにはレコード セットのデータ メンバーの値を変更すると、検出、 **PSEUDO_**レコード セットに格納できるデータ型ごとに適切な値です。 場合、フィールドを明示的に設定する必要があります、 **PSEUDO_**とフィールドの値は、Null の場合、マークする既には発生も呼び出す必要があります`SetFieldNull`、最初のパラメーターのフィールドのアドレスを渡すと**FALSE**2 番目のパラメーターです。  
  
##  <a name="_core_visibility_of_added_records"></a>追加されたレコードの可視性  
 追加したレコードは、レコード セットを表示しますか。 追加されたレコードは、場合によって表示され、場合によっては表示されず、2 つの操作によって。  
  
-   どのようなドライバーはできます。  
  
-   どのようなフレームワークを利用します。  
  
 ODBC ドライバーがサポートされている場合、 **:: SQLSetPos** ODBC API 関数では、MFC では、関数を使用して、レコードを追加します。 **:: SQLSetPos**、追加したレコードは、更新可能な MFC のレコード セットを表示します。 関数のサポートがなければ追加レコードを表示して、呼び出す必要があります**Requery**にそれらを参照してください。 使用して**:: SQLSetPos**も効率的です。  
  
##  <a name="_core_editing_an_existing_record"></a>既存のレコードの編集  
 レコード セット内の既存のレコードを編集するには、レコード セットのレコードをスクロールが含まれます[編集](../../mfc/reference/crecordset-class.md#edit)メンバー関数の場合、新しいレコードのフィールド データ メンバーの値を設定して、呼び出し、[更新](../../mfc/reference/crecordset-class.md#update)メンバー関数、データ ソースに変更されたレコードを書き込めません。  
  
 呼び出し元の事前条件として**編集**、更新可能なとレコードのレコード セットがある必要があります。 `CanUpdate`と`IsDeleted`メンバー関数を使用して、これらの条件を確認できます。 現在のレコードもする必要がありますされませんが、既に削除されて、レコード セットのレコードが必要 (両方`IsBOF`と`IsEOF`0 が返されます)。  
  
 呼び出すと**編集**をエディット バッファー (現在のレコード) 内のレコードが格納されています。 ストアドのレコードの値は後で、任意のフィールドが変更されたかどうかを検出するために使用します。  
  
 呼び出した後**編集**をエディット バッファーはまだ現在のレコードを表しますが、フィールド データ メンバーへの変更をそのまま使用する準備ができました。 レコードを変更するには、手動で編集する任意のフィールド データ メンバーの値を設定する必要があります。 呼び出すことができます、実際のデータのフィールドの値を指定するには、代わりに`SetFieldNull`を Null 値を指定します。 変更をコミットする呼び出し**更新**です。  
  
> [!TIP]
>  活用する`AddNew`または**編集**モード、呼び出し**移動**パラメーターを使用して**AFX_MOVE_REFRESH**です。  
  
 呼び出し元の事前条件として**更新**レコード セットは空にすること、および現在のレコード必要がありますが削除されていません。 `IsBOF`、 `IsEOF`、および`IsDeleted`0 を返す必要があります。  
  
 呼び出すと**更新**編集されたレコード。  
  
-   ODBC ドライバーがサポートされている場合、 **:: SQLSetPos** ODBC API 関数では、MFC では、関数を使用して、データ ソースのレコードを更新します。 **:: SQLSetPos**ドライバーがサーバーで、2 つが異なる場合、サーバー上のレコードの更新の対応するレコードをエディット バッファーを比較します。 **:: SQLSetPos**、MFC レコードを更新できるより効率的に構築し、SQL ステートメントの処理があるないためです。  
  
     - または -  
  
-   場合**:: SQLSetPos**することはできません、次の処理を MFC を使用します。  
  
    1.  行われていない場合、変更**更新**何も行わないし、0 を返します。  
  
    2.  変更がある場合**更新**構築 SQL**更新**ステートメントです。 示されている列、**更新**ステートメントが変更されたフィールド データ メンバーに基づきます。  
  
    3.  **更新**の変更をコミット — 実行、**更新**ステートメント — と、レコードがデータ ソースで変更されたが、コミットされていない場合はトランザクションが進行中です (を参照してください[トランザクション: でのトランザクションの実行レコード セット (ODBC)](../../data/odbc/transaction-performing-a-transaction-in-a-recordset-odbc.md)トランザクションが、更新プログラムに与える影響について)。 ODBC では、変更もあり、レコードのコピーを保持します。  
  
    4.  プロセスとは異なり`AddNew`、**編集**ストアド レコードは復元されません。 編集済みのレコードは、現在のレコードとしての場所に残ります。  
  
    > [!CAUTION]
    >  呼び出すことによって、レコード セットを更新する準備するときに**更新**、レコード セットが、テーブルの主キーを構成するすべての列が含まれることに注意 (または任意の一意の列のすべてのインデックス、テーブル、または十分な列を一意に行を特定する)。 場合によっては、フレームワークは、レコードセット内で選択されている列だけに基づいてテーブル内の更新するレコードを特定します。 必要なすべての列のない複数のレコードは、テーブルの更新可能性があります。 呼び出すときにフレームワークが例外をスローするこの例では、**更新**です。  
  
    > [!TIP]
    >  呼び出す場合は`AddNew`または**編集**以前がする前に、いずれかの関数を呼び出したことの後に呼び出す**更新**をエディット バッファーで新しいまたは編集されたレコードを置き換えるストアドのレコードに更新進行中です。 この動作により、中止する方法、`AddNew`または**編集**し、新しい開始: 進行中のレコードが障害であると判断した場合を呼び出すだけ**編集**または`AddNew`もう一度です。  
  
##  <a name="_core_deleting_a_record"></a>レコードを削除します。  
 レコード セットからレコードを削除するには、レコードをスクロールし、レコード セットの[削除](../../mfc/reference/crecordset-class.md#delete)メンバー関数。 異なり`AddNew`と**編集**、**削除**に一致する呼び出しは必要ありません**更新**です。  
  
 呼び出し元の事前条件として**削除**レコード セットは更新可能である必要があります、およびそのレコードに存在する必要があります。 `CanUpdate`、 `IsBOF`、 `IsEOF`、および`IsDeleted`メンバー関数を使用して、これらの条件を確認できます。  
  
 呼び出すと**削除**:  
  
-   ODBC ドライバーがサポートされている場合、 **:: SQLSetPos** ODBC API 関数では、MFC では、関数を使用して、データ ソースのレコードを削除します。 使用して**:: SQLSetPos** SQL を使用するよりも効率的です。  
  
     - または -  
  
-   場合**:: SQLSetPos**することはできません、次の処理を MFC を使用します。  
  
    1.  エディット バッファーの現在のレコードはバックアップされませんとして`AddNew`と**編集**です。  
  
    2.  **削除**構築 SQL**削除**レコードを削除するステートメント。  
  
         エディット バッファーの現在のレコードとしてに格納されていない`AddNew`と**編集**です。  
  
    3.  **削除**削除をコミット — 実行、**削除**ステートメントです。 レコードのデータ ソースでは、削除済みとマークされ、レコードが ODBC でのスナップショットです。  
  
    4.  削除されたレコードの値も、レコード セットのフィールド データ メンバーは、フィールド データ メンバーには Null とレコード セットのマーク`IsDeleted`メンバー関数は 0 以外の値を返します。  
  
    > [!NOTE]
    >  レコードを削除した後にを新しいレコードのデータをエディット バッファーを補充する別のレコードをスクロールする必要があります。 呼び出すとエラーは**削除**再度または呼び出しを行う**編集**です。  
  
 更新操作で使用される SQL ステートメントの概要については、次を参照してください。 [SQL](../../data/odbc/sql.md)です。  
  
## <a name="see-also"></a>参照  
 [レコード セット (ODBC)](../../data/odbc/recordset-odbc.md)   
 [レコード セット: 更新プログラムについて (ODBC)](../../data/odbc/recordset-more-about-updates-odbc.md)   
 [レコード フィールド エクスチェンジ (RFX)](../../data/odbc/record-field-exchange-rfx.md)